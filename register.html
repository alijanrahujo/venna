<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="fonts/icomoon/style.css">

    <link rel="stylesheet" href="css/owl.carousel.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    
    <!-- Style -->
    <link rel="stylesheet" href="css/style.css">

    <title>Affiliate Login</title>

  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <link rel="shortcut icon" href="assets/images/wechat-image-20190701154719-122x51.png" type="image/x-icon">
  <meta name="description" content="">
  
  
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/animatecss/animate.min.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
  <link rel="stylesheet" href="css/sweetalert2.min.css" type="text/css">
  
  </head>
  <body>
  <section class="menu cid-qTkzRZLJNu" once="menu" id="menu1-0">

    

    <nav class="navbar navbar-expand beta-menu navbar-dropdown align-items-center navbar-fixed-top navbar-toggleable-sm">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        <div class="menu-logo">
            <div class="navbar-brand">
                <span class="navbar-logo">
                    <a href="index.html">
                         <img src="assets/images/wechat-image-20190701154719-122x51.png" alt="Mobirise" title="" style="height: 3.8rem;">
                    </a>
                </span>
                
            </div>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav nav-dropdown" data-app-modern-menu="true"><li class="nav-item">
                    <a class="nav-link link text-white display-7" href="index.html">Home<br></a>
                </li><li class="nav-item"><a class="nav-link link text-white display-7" href="page1.html">About Us
                    </a></li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-7" href="page2.html" data-toggle="dropdown-submenu" aria-expanded="true">Products</a><div class="dropdown-menu"><a class="text-white dropdown-item display-7" href="page7.html">VENNA Rice Spa<br></a><a class="text-white dropdown-item display-7" href="page5.html">VENNA Indox<br></a><a class="text-white dropdown-item display-7" href="page8.html">VENNA Lovena<br></a></div></li><li class="nav-item"><a class="nav-link link text-white display-7" href="page4.html">Contact</a></li>

                    <li class="nav-item"><a class="nav-link link text-white display-7" href="login.html">Login</a></li>

                    <li class="nav-item"><a class="nav-link link text-white display-7" href="register.html">Register</a></li>
                  </ul>
            <div class="navbar-buttons mbr-section-btn"><a class="btn btn-sm btn-primary display-4" href="page6.html">
                    
                    CHINESE</a> <a class="btn btn-sm btn-primary display-4" href="index.html">ENGLISH</a></div>
        </div>
    </nav>
</section>
  
  <div class="content">
    <div class="container">
      <div class="row justify-content-center">
        <!-- <div class="col-md-6 order-md-2">
          <img src="images/undraw_file_sync_ot38.svg" alt="Image" class="img-fluid">
        </div> -->
        <div class="col-md-6 contents">
          <div class="row justify-content-center">
            <div class="col-md-12">
              <div class="form-block">
                  <div class="mb-4">
                    <h3><center>Sign Up Your User Account</center></h3>
                    <p class="mb-4"><center>Fill all form field to go to next step</center></p>
                </div>  
                <div id="first_step">
                    <label style="font-size: small; color: gray;"><b>Referral Username</b>
                      This is a member only portal. Sign up with a referral username!</label>
                    <div class="form-group first">
                      <label for="username">Username</label>
                      <input type="text" name="username" class="form-control" id="username">
                    </div>
                    <input type="button" value="Next Step" id="referral" class="btn btn-pill text-white btn-block btn-primary">
                  </div>
                  <form id="register_form" method="post">
                    <div class="form-group last mb-4">
                      <label for="email">Email</label>
                      <input type="email" name="email" class="form-control" id="email">
                    </div>
                    
                    <div class="form-group last mb-4">
                      <label for="password">Password</label>
                      <input type="password" name="password" class="form-control" id="password">
                    </div>
                    
                    <div class="form-group last mb-4">
                      <label for="cfm_password">Comfirm Password</label>
                      <input type="password" name="cfm_password" class="form-control" id="cfm_password">
                    </div>

                    <input type="hidden" class="form-control" name="referral_username" id="hidden_referral_username">
                    <input type="hidden" class="form-control" name="voucher_code" id="voucher_code">

                  <input type="submit" value="Submit" class="btn btn-pill text-white btn-block btn-primary">
                </form>
              </div>
            </div>
          </div>
          
        </div>
        
      </div>
    </div>
  </div>


    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="js/ip.js"></script>
    <script src="js/sweetalert2.min.js"></script>
    <script src="js/webscript.js"></script>
  </body>
</html>

<script>
  $(document).ready(function(){
    $('#register_form').hide();
  })

  $('#referral').click(function(){
        var check_username = new FormData();
        check_username.set('api_key', api_key);
        check_username.set('username', $("#username").val());
        check_username.set('subdomain', 'venna');
        axios.post(address + 'v1/Auth_Api/check_referral_username', check_username, apiHeader)
            .then(function(response) {
                if (response.data.status == "Success") {
                    console.log(response);
                    $("#hidden_referral_username").val(response.data.data.username);
                    $("#register_form").show();
                    $("#first_step").hide();
                } else {
                    warning_response(response.data.message);
                }
            })
            .catch(function(data) {});
  })

  $('#register_form').submit(function(e) {
        e.preventDefault();
        var register_user = new FormData(this);
        register_user.set('api_key', api_key);
        axios.post(address + 'v1/Auth_Api/register', register_user, apiHeader)
            .then(function(response) {
                if (response.data.status == "Success") {
                    Swal.fire({
                        type: "success",
                        text: "Register Successfully !",
                        confirmButtonText: 'OK'
                    }).then((result) => {
                        call_login(response.data.data);
                    })
                } else {
                    warning_response(response.data.message);
                }
            })
            .catch(function(data) {

            });
    });


    function call_login(data) {
        var agent_login = new FormData();
        agent_login.set('api_key', api_key);
        agent_login.set('email', data.email);
        agent_login.set('password', data.password);

        axios.post(address + 'v1/Auth_Api/login', agent_login, apiHeader)
            .then(function(response) {
                if (response.data.status == "Success") {
                    localStorage.oauth_token = response.data.data.oauth_client_token;
                    localStorage.access_token = response.data.data.access_token;
                    localStorage.user_id = response.data.data.user_id;

                    if (response.data.data.is_step1 == 0) {
                        success_response(true, "register1.html");
                    } else if (response.data.data.is_step2 == 0) {
                        success_response(true, "register2.html");
                    } else if (response.data.data.is_step3 == 0) {
                        success_response(true, "register3.html");
                    } else if (response.data.data.is_step4 == 0) {
                        success_response(true, "register4.html");
                    } else if (response.data.data.is_done == 0) {
                        success_response(true, "soft/pages/dashboard.html");
                    } else {
                        success_response(true, "soft/pages/dashboard.html");
                    }
                } else {
                    warning_response(response.data.message);
                }
            })
            .catch(function(data) {
                console.log(data);
                error_response();
            });
    }
</script>